exam-app/
‚îú‚îÄ‚îÄ docker-compose.yaml   (‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Server)
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ index.php         (‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL)

1. ‡πÑ‡∏ü‡∏•‡πå docker-compose.yaml
‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå docker-compose.yaml ‡∏Ñ‡∏£‡∏±‡∏ö

version: '3.8'

services:
  # 1. ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡πá‡∏ö (PHP + Apache)
  web:
    image: php:7.4-apache
    container_name: my-web-container
    ports:
      - "8080:80"        # ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ú‡πà‡∏≤‡∏ô localhost:8080
    volumes:
      - ./src:/var/www/html # ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå src ‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤ Container
    depends_on:
      - db               # ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏≠ Database ‡∏£‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
    # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Extension ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Database
    command: >
      bash -c "docker-php-ext-install pdo pdo_mysql && apache2-foreground"

  # 2. ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (MariaDB/MySQL)
  db:
    image: mariadb:10.6
    container_name: my-db-container
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword  # ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Root
      MYSQL_DATABASE: exam_db            # ‡∏ä‡∏∑‡πà‡∏≠ Database ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á
      MYSQL_USER: user1                  # ‡∏ä‡∏∑‡πà‡∏≠ User
      MYSQL_PASSWORD: userpassword       # ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô User
    volumes:
      - db_data:/var/lib/mysql           # ‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢

volumes:
  db_data:

2. ‡πÑ‡∏ü‡∏•‡πå src/index.php
‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ä‡∏∑‡πà‡∏≠ src ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå index.php ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exam Result</title>
    <style>table, th, td { border: 1px solid black; border-collapse: collapse; padding: 10px; }</style>
</head>
<body>
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ç‡πâ‡∏≠ App + DB)</h1>

    <?php
    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö docker-compose.yaml) ---
    $servername = "db";  // *‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç* ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ Service "db" ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ localhost
    $username = "user1";
    $password = "userpassword";
    $dbname = "exam_db";

    try {
        // 1. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
        $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        echo "<h3 style='color:green;'>‚úÖ Connected successfully (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)</h3>";

        // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
        $sql_create = "CREATE TABLE IF NOT EXISTS sensor_data (
            id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
            val INT(3) NOT NULL,
            status VARCHAR(30) NOT NULL,
            reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )";
        $conn->exec($sql_create);

        // 3. (INSERT) ‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        $randVal = rand(100, 500); // ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏±‡∏ô
        $status = ($randVal > 300) ? "Danger" : "Normal";
        $sql_insert = "INSERT INTO sensor_data (val, status) VALUES ($randVal, '$status')";
        $conn->exec($sql_insert);
        echo "Insert New Data: Value = $randVal ($status)<br><br>";

        // 4. (SELECT) ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        $stmt = $conn->prepare("SELECT id, val, status, reg_date FROM sensor_data ORDER BY id DESC LIMIT 10");
        $stmt->execute();
        $result = $stmt->fetchAll();

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        echo "<table><tr><th>ID</th><th>Smoke Value</th><th>Status</th><th>Time</th></tr>";
        foreach($result as $row) {
            $color = ($row['status'] == 'Danger') ? 'red' : 'green';
            echo "<tr>";
            echo "<td>" . $row['id'] . "</td>";
            echo "<td>" . $row['val'] . "</td>";
            echo "<td style='color:$color; font-weight:bold;'>" . $row['status'] . "</td>";
            echo "<td>" . $row['reg_date'] . "</td>";
            echo "</tr>";
        }
        echo "</table>";

    } catch(PDOException $e) {
        echo "<h3 style='color:red;'>‚ùå Connection failed: " . $e->getMessage() . "</h3>";
    }
    ?>
</body>
</html>








<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom IoT Dashboard</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f4f9; text-align: center; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .status-box { font-size: 24px; font-weight: bold; margin: 20px 0; padding: 15px; border-radius: 8px; display: inline-block; width: 100%; }
        .safe { background-color: #d4edda; color: #155724; }
        .danger { background-color: #f8d7da; color: #721c24; }
        .value-display { font-size: 80px; font-weight: bold; color: #333; margin: 10px 0; }
        canvas { max-width: 100%; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üî• ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h1>
        <p>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô MQTT WebSockets (Port 9001)</p>

        <div id="statusBox" class="status-box safe">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
        <div class="value-display"><span id="smokeValue">0</span> <span style="font-size:20px">ppm</span></div>

        <canvas id="smokeChart"></canvas>
    </div>

    <script>
        // --- 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ---
        // ‡∏ñ‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ä‡πâ localhost, ‡∏ñ‡πâ‡∏≤Server‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà IP
        const mqttUrl = 'ws://localhost:9001'; 
        const topic = 'sensor/smoke';

        // --- 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏£‡∏≤‡∏ü (Chart.js) ---
        const ctx = document.getElementById('smokeChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], // ‡πÄ‡∏ß‡∏•‡∏≤
                datasets: [{
                    label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏±‡∏ô (Smoke Level)',
                    data: [],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true, max: 1000 } }
            }
        });

        // --- 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT ---
        console.log("Connecting to MQTT...");
        const client = mqtt.connect(mqttUrl);

        client.on('connect', () => {
            console.log('‚úÖ Connected via WebSockets!');
            client.subscribe(topic, (err) => {
                if (!err) console.log(`Subscribed to ${topic}`);
            });
        });

        client.on('message', (topic, message) => {
